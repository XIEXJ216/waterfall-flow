<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Document</title>
  <style type="text/css">
    body{
      margin: 0;
      padding: 0;
    }
    .pubu{
      position: absolute;
      width: 1100px;
      left: 50%;
      margin-left: -550px;
    }
    .box{
      padding:20px 0 0 20px;
      float: left;
    }
    .box img{
      width: 200px;
      height: auto;
      opacity: 0;
    }
  </style>
</head>
<body>
<div class="pubu">
  <div class="box">
    <img data-original="images/1.png" src="images/1.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/2.png" src="images/2.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/3.png" src="images/3.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/4.png" src="images/4.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/5.png" src="images/5.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/6.png" src="images/6.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/7.png" src="images/7.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/8.png" src="images/8.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/9.png" src="images/9.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/10.png" src="images/10.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/11.png" src="images/11.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/12.png" src="images/12.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/13.png" src="images/13.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/14.png" src="images/14.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/15.png" src="images/15.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/16.png" src="images/16.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/17.png" src="images/17.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/18.png" src="images/18.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/19.png" src="images/19.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/20.png" src="images/20.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/21.png" src="images/21.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/22.png" src="images/22.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/23.png" src="images/23.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/24.png" src="images/24.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/25.png" src="images/25.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/26.png" src="images/26.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/27.png" src="images/27.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/28.png" src="images/28.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/29.png" src="images/29.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/30.png" src="images/30.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/31.png" src="images/31.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/32.png" src="images/32.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/33.png" src="images/33.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/34.png" src="images/34.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/35.png" src="images/35.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/36.png" src="images/36.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/37.png" src="images/37.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/38.png" src="images/38.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/39.png" src="images/39.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/40.png" src="images/40.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/41.png" src="images/41.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/42.png" src="images/42.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/43.png" src="images/43.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/44.png" src="images/44.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/45.png" src="images/45.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/46.png" src="images/46.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/47.png" src="images/47.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/48.png" src="images/48.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/49.png" src="images/49.png" alt="">
  </div>
  <div class="box">
    <img data-original="images/50.png" src="images/50.png" alt="">
  </div>
</div>
<script type="text/javascript">
  window.onload = function(){
    var oBox=document.getElementsByClassName("box");
    var oImg=document.getElementsByTagName('img');
    var oBoxw=oBox[0].offsetWidth;
    var cols=5;

    loadImg(oImg);
    window.onscroll = function(){
      loadImg(oImg);
    };

    function waterfall(ele,col,eleWidth){
      var hArr = [];
      for(var i = 0;i < ele.length;i++){
        if(i < col){
          hArr.push(ele[i].offsetHeight);
        }else{
          //min不能用于数组，apply的第一个参数传递作用域，第二个参数传递数组。Math.min.apply(null, [1, 2, 3]) 等价于 Math.min(1, 2, 3)
          var minH = Math.min.apply(null,hArr);
          var index = hArr.indexOf(minH);
          ele[i].style.position = 'absolute';
          ele[i].style.top = minH + 'px';           //ele.style.left/top 是有px的，而offsetHeight/offsetWidth是没有px的
          ele[i].style.left = index * eleWidth + 'px';
          hArr[index] += ele[i].offsetHeight;
        }
      }
    }

    function loadImg(arr){
      for( var i = 0,len = arr.length; i < len; i++){
        //判断图片相对应视图窗口的高度是否小于屏幕可视窗口大小
        if(arr[i].getBoundingClientRect().top < document.documentElement.clientHeight && !arr[i].isLoad){  //判断图片
          arr[i].isLoad = true;
          if(arr[i].dataset){                    //判断是否存在HTML5的dataset对象
            aftLoadImg(arr[i],arr[i].dataset.original);
          }else{
            aftLoadImg(arr[i],arr[i].getAttribute("data-original"));
          }
          arr[i].style.cssText = "transition: opacity 4s; opacity: 1;"    //使opacity变化在4秒内完成
        }
      }
    }

    function aftLoadImg(obj,url){
      obj.src = url;
      waterfall(oBox,cols,oBoxw);   //需要再次调用瀑布流方法
    }
  }
</script>
</body>
</html>
